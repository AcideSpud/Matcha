<% include header2 %>

<div class="container">

<div class="col-sm-6 col-sm-offset-3">
    <div class="jumbotron text-center"  style="padding:40px;">
    <h2><span class="fa fa-sign-in">Votre Profile</span></h2>
    <hr>
    <div>
            <% if (ret[0].img[0]) { %>
            <img src="<%= ret[0].img[0] %>" alt="Profile picture" height="100" width="100">
            <% } else { %>
            <img src="/img/no_image.png" alt="Pas encore de photo de profile" height="100" width="100">
            <% } %>
            <br>
    </div>
    <div>
        <% if (ret[0].liker && ret[0].visit) { %>
        <span><%= ret[0].liker.length %> vous aimes,</span>
        <span><%= ret[0].visit.length %> vous as visité</span>
        <% } else { %>
    </div>
    <div>
        <span> 0 vous aimes</span>
        <span> 0 vous as visité</span>
        <% } %>
    </div>
    <br>
    <hr>

    
    
    <script>
    function cloneAsObject(obj) {
        if (obj === null || !(obj instanceof Object))
            return obj;
        var temp = (obj instanceof Array) ? [] : {};
        for (var key in obj)
            temp[key] = cloneAsObject(obj[key]);
        return temp;
    }
    
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(position){
            $("#geoResult").val(JSON.stringify(cloneAsObject(position.coords)));
        })
    }
    else{
        $.getJSON("http://ip-api.com/json/?callback=?", function(data) {
            $("#geoResult").val(JSON.stringify(data));
        });

    
    }
    </script>
<script type="text/javascript">
    
</script>
    <!-- LOGIN FORM -->
    <form class="form-horizontal" action="compte/form_compte" method="post">
        
        
        

        <div class="form-group">
            <input type="text" class="form-control" name="email" required="required"
            placeholder="Email" value="<%= ret[0].email %>">
        </div>

        <div class="form-group">
            <input type="password" class="form-control" id="pwd" name="pwd" required="required" placeholder="Password" value="">
        </div>
        <hr>

        <div class="form-group">
            <input type="text" class="form-control" id="nom" name="nom" required="required" placeholder="Nom" value="<%= ret[0].nom %>">
        </div>

        <div class="form-group">
            <input type="text" class="form-control" id="prenom" name="prenom" required="required" placeholder="Prénom" value="<%= ret[0].prenom %>">
        </div>
        <% if (city && country && ret[0].geo) { %>
        <div class="form-group">
            <span>Latitude</span>
            <input name="lat" style="width:100%;" type="number"  value="<%= ret[0].geo.latitude %>" >
        </div>
         <div class="form-group">
            <span>Longitude</span>
            <input name="long" style="width:100%;" type="number"  value="<%= ret[0].geo.longitude %>" >
        </div>
        
        <div class="form-group">
            <p style="{font-size: 0.3em;}"> (<%= city %> / <%= country %> )</p>
        </div>
    <% } %>


        <div class="form-group">
            <label class="control-label col-sm-2">Age *</label>
            <input type="number" name="age" min="18" max="100" required="required" value="<%= ret[0].age %>">
        </div>

        <div class="form-group">
        	<label class="control-label col-sm-2">Genre </label>
        	<label class="radio-inline">
            <% if (ret[0].genre == 'M') { %>
        		<input type="radio" name="genre" value="M" checked="checked" />Masculin
            <% } else { %>
                <input type="radio" name="genre" value="M" />Masculin
            <% } %>

        	</label>
			<label class="radio-inline">
			<% if (ret[0].genre == 'Mme') { %>
                <input type="radio" name="genre" value="Mme" checked="checked" />Feminin
            <% } else { %>
                <input type="radio" name="genre" value="Mme" />Feminin
            <% } %>
			</label>
			<label class="radio-inline">
			<% if (ret[0].genre == 'Tran') { %>
                <input type="radio" name="genre" value="Tran" checked="checked" />Indefini
            <% } else { %>
                <input type="radio" name="genre" value="Tran" />Indefini
            <% } %>
			</label>
        </div>


        <div class="form-group">
            <label class="control-label col-sm-2">Orientation</label>
            <label class="radio-inline">
                <% if (ret[0].orientation == 'Ht') { %>
                <input type="radio" name="orientation" value="Ht" checked="checked" />Heterosexuel
            <% } else { %>
                <input type="radio" name="orientation" value="Ht" />Heterosexuel
            <% } %>
            </label>
            <label class="radio-inline">
                <% if (ret[0].orientation == 'Hm') { %>
                <input type="radio" name="orientation" value="Hm" checked="checked" />Homosexuel
            <% } else { %>
                <input type="radio" name="orientation" value="Hm" />Homosexuel
            <% } %>
            </label>
            <label class="radio-inline">
             <% if (ret[0].orientation == 'Bi') { %>
                <input type="radio" name="orientation" value="Bi" checked="checked" />Bisexuel
            <% } else { %>
                <input type="radio" name="orientation" value="Bi" />Bisexuel
            <% } %>
            </label>
        </div>

        <div class = "form-group">
            <label>Put some #hobbies</label>
            <textarea class="form-control" rows="3" id="hastag" name="hashtag" maxlength="200" placeholder="Put some #hobbies (200 caractères)" value=""><% for (var i = 0; i < tag.length; i++ ){ %> <%= tag[i] %> <% } %></textarea>
        </div>

        <div class="form-group">
            <label>Tell us about you</label>
  				<textarea class="form-control" rows="4" id="comment" name="bio" maxlength="200" placeholder="Biographie (200 caractères)" value=""><%= ret[0].bio %></textarea>
		</div>
		<hr>
        <div class="form-group">
            <input type="hidden" name="geo" id="geoResult" value=""></input>
        </div>
        <div class="form-group">
        <button type="submit" class="btn btn-warning btn-lg">Enregistrer</button>
    </form>
</div>
</div>
</div>


<script src="socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect('http://localhost:3000');
    socket.emit('notification_newMsg', '<%= user[0].name %>');

    notif();
    var myVar = setInterval(notif, 2000);

    function notif(){
        

        socket.on('connect', function(){
        socket.emit('notification_like', '<%= user[0].name %>');
        socket.emit('notification_newMsg', '<%= user[0].name %>');
        socket.emit('notification_newMsg_unread', '<%= user[0].name %>');

         socket.on('notif_like', (res, img)=>{
            $('#notifliking').empty();
            for(var i = 0; i < res.length; i++){
            $('#notifliking').prepend('<li><a class="dropdown-item" href="/profile/'+res[i].userSend+'"> <strong><i>'+ res[i].type + '</i> ' + res[i].userSend + ' </strong> <p>'+ res[i].date + '</p></a></li>');
            }
         })
         socket.on('notif_all_like', (res)=>{
            $('#all_like').empty();
            for(var i = 0; i < res.length; i++){
            $('#all_like').prepend('<li><a class="dropdown-item" href="/profile/'+res+'"> <strong>'+ res  + ' </strong></a></li>');
            }
         }) 
         socket.on('notif_all_visit', (res)=>{
            $('#all_visit').empty();
            for(var i = 0; i < res.length; i++){
              $('#all_visit').prepend('<li><a class="dropdown-item" href="/profile/'+res[i]+'"> <strong>'+ res[i]  + ' </strong></a></li>');  
            }
         }) 
         socket.on('nb_msg_unread', (res)=>{
            $('#notif_msg_nb').text(res);
         })
        socket.on('nb_notif_unread', (res)=>{
            $('#notif_nb').text(res);
         }) 
         socket.on('notif_newMsg', (res, crn)=>{

            for(var i = 0; i < res.length; i++){
            $('#notif_msg').prepend('<li><a class="dropdown-item" href="/chat" onclick="return send_info_chat2('+ crn + ', \'<%= user[0].name %>\')"><strong>' + res[i].user + '</strong>: le ' + res[i].date  +'</a></li>');
                }
            
            })
        })
    }  
</script>

<%include footer_dash %>
